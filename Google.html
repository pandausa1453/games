<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Search</title>
</head>
  <script>
    function openWithProxy(event) {
        let target = event.target;

        // Find the actual <a> element in case the user clicks inside a div or span
        while (target && target.tagName !== "A") {
            target = target.parentElement;
        }

        if (target && target.href) {
            event.preventDefault(); // Stop default action

            // Cloudflare Worker Proxy URL with proper query parameter
            let proxyURL = `https://muddy-pond-b7b3.cookinglol001.workers.dev/?url=${encodeURIComponent(target.href)}`;

            // Open the proxied URL in a new window with defined size
            window.open(proxyURL, "_blank", "width=800,height=600");
        }
    }

    function attachLinkListeners() {
        // Targeting Google Custom Search result links
        document.querySelectorAll(".gsc-results .gsc-webResult a").forEach(link => {
            link.removeEventListener("click", openWithProxy);
            link.addEventListener("click", openWithProxy);
        });
    }

    // Observe dynamic changes to search results and apply the listener
    const observer = new MutationObserver(attachLinkListeners);
    observer.observe(document.body, { childList: true, subtree: true });

    document.addEventListener("DOMContentLoaded", attachLinkListeners);
</script>
<body>
    <h2>Search</h2>

    <!-- Google Custom Search Box and Results -->
    <script async src="https://cse.google.com/cse.js?cx=5240a0e622ec54648"></script>
    <div class="gcse-search"></div>

<script>
    function forceLinksToNewWindow(event) {
        let target = event.target;

        // Find the actual <a> element in case of nested clicks
        while (target && target.tagName !== "A") {
            target = target.parentElement;
        }

        if (target && target.href) {
            event.preventDefault(); // Stop default action
            window.open(target.href, "_blank", "width=1000,height=700,left=100,top=50,noopener");
        }
    }

    function attachLinkListeners() {
        document.querySelectorAll(".gsc-results .gsc-webResult a").forEach(link => {
            link.removeEventListener("click", forceLinksToNewWindow);
            link.addEventListener("click", forceLinksToNewWindow);
        });
    }

    // Observe dynamic changes and attach event listeners
    const observer = new MutationObserver(attachLinkListeners);
    observer.observe(document.body, { childList: true, subtree: true });

    // Run on page load
    document.addEventListener("DOMContentLoaded", attachLinkListeners);
</script>

</body>
</html>
