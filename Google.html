<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Search</title>
</head>
<body>
    <h2>Search</h2>

    <!-- Google Custom Search Box and Results -->
    <script async src="https://cse.google.com/cse.js?cx=5240a0e622ec54648"></script>
    <div class="gcse-search"></div>

    <script>
        function openWithProxy(event) {
            let target = event.target;

            // Find the actual <a> element if clicking inside other elements
            while (target && target.tagName !== "A") {
                target = target.parentElement;
            }

            if (target && target.href) {
                event.preventDefault(); // Stop the default action

                // Cloudflare Worker Proxy URL with proper query parameter
                let proxyURL = `https://muddy-pond-b7b3.cookinglol001.workers.dev/?url=${encodeURIComponent(target.href)}`;

                // Always open in a new window, regardless of iframe or not
                const newWindow = window.open(proxyURL, "_blank", "width=1000,height=700,left=100,top=50,noopener");

                if (newWindow) {
                    newWindow.focus();
                } else {
                    alert("Pop-up blocked! Please allow pop-ups for this site.");
                }
            }
        }

        // Attach event listeners to search result links
        function attachLinkListeners() {
            document.querySelectorAll(".gsc-results .gsc-webResult a").forEach(link => {
                link.removeEventListener("click", openWithProxy);
                link.addEventListener("click", openWithProxy);
            });
        }

        // Observe dynamic changes and apply the event listener
        const observer = new MutationObserver(attachLinkListeners);
        observer.observe(document.body, { childList: true, subtree: true });

        // Run on page load
        document.addEventListener("DOMContentLoaded", attachLinkListeners);

        function openWithProxy(event) {
    let target = event.target;

    // Traverse up the DOM to find the <a> tag
    while (target && target.tagName !== "A") {
        target = target.parentElement;
    }

    if (target && target.href) {
        event.preventDefault(); // Stop default action

        // Construct the proxied URL properly
        let proxyURL = `https://muddy-pond-b7b3.cookinglol001.workers.dev/?url=${encodeURIComponent(target.href)}`;

        // Open the proxied URL in a new window
        const newWindow = window.open(proxyURL, "_blank", "width=1000,height=700,left=100,top=50,noopener");

        if (newWindow) {
            newWindow.focus(); 
        } else {
            alert("Pop-up blocked! Please allow pop-ups for this site.");
        }
    }
}

// Attach listeners to search result links
function attachLinkListeners() {
    document.querySelectorAll(".gsc-results .gsc-webResult a").forEach(link => {
        link.removeEventListener("click", openWithProxy);
        link.addEventListener("click", openWithProxy);
    });
}

// Monitor dynamic changes and reapply listeners
const observer = new MutationObserver(attachLinkListeners);
observer.observe(document.body, { childList: true, subtree: true });
document.addEventListener("DOMContentLoaded", attachLinkListeners);

    </script>

</body>
</html>

